<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{- |
Module      :  XMonad.Prompt.Zsh
Description :  Zsh-specific version of &quot;XMonad.Prompt.Shell&quot;.
Copyright   :  (C) 2020 Zubin Duggal
License     :  BSD3

Maintainer  :  zubin.duggal@gmail.com
Stability   :  unstable
Portability :  unportable

A version of &quot;XMonad.Prompt.Shell&quot; that lets you access the awesome power of Zsh
completions in your xmonad prompt
-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">XMonad.Prompt.Zsh</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Usage</span></span><span>
</span><span id="line-17"></span><span>      </span><span class="annot"><span class="hs-comment">-- $usage</span></span><span>
</span><span id="line-18"></span><span>      </span><span class="annot"><a href="XMonad.Prompt.Zsh.html#Zsh"><span class="hs-identifier">Zsh</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="XMonad.Prompt.Zsh.html#zshPrompt"><span class="hs-identifier">zshPrompt</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Utility functions</span></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="XMonad.Prompt.Zsh.html#getZshCompl"><span class="hs-identifier">getZshCompl</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier">stripZsh</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">XMonad</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="XMonad.Prompt.html"><span class="hs-identifier">XMonad.Prompt</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="XMonad.Util.Run.html"><span class="hs-identifier">XMonad.Util.Run</span></a></span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-comment">{- $usage
1. Grab the @capture.zsh@ script to capture zsh completions from &lt;https://github.com/Valodim/zsh-capture-completion&gt;
2. In your @~\/.xmonad\/xmonad.hs@:

&gt; import XMonad.Prompt
&gt; import XMonad.Prompt.Zsh

3. In your keybindings add something like:

&gt;   , ((modm .|. controlMask, xK_x), zshPrompt def &quot;/path/to/capture.zsh&quot;)

For detailed instruction on editing the key binding see
&quot;XMonad.Doc.Extending#Editing_key_bindings&quot;. -}</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">data</span><span> </span><span id="Zsh"><span class="annot"><a href="XMonad.Prompt.Zsh.html#Zsh"><span class="hs-identifier hs-var">Zsh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Zsh"><span class="annot"><a href="XMonad.Prompt.Zsh.html#Zsh"><span class="hs-identifier hs-var">Zsh</span></a></span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679389937"><span id="local-6989586621679389939"><span class="annot"><a href="XMonad.Prompt.html#XPrompt"><span class="hs-identifier hs-type">XPrompt</span></a></span><span> </span><span class="annot"><a href="XMonad.Prompt.Zsh.html#Zsh"><span class="hs-identifier hs-type">Zsh</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>    </span><span id="local-6989586621679389935"><span class="annot"><span class="annottext">showXPrompt :: Zsh -&gt; String
</span><a href="XMonad.Prompt.html#showXPrompt"><span class="hs-identifier hs-var hs-var hs-var hs-var">showXPrompt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Zsh
</span><a href="XMonad.Prompt.Zsh.html#Zsh"><span class="hs-identifier hs-var">Zsh</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Run: &quot;</span></span><span>
</span><span id="line-47"></span><span>    </span><span id="local-6989586621679389933"><span class="annot"><span class="annottext">completionToCommand :: Zsh -&gt; String -&gt; String
</span><a href="XMonad.Prompt.html#completionToCommand"><span class="hs-identifier hs-var hs-var hs-var hs-var">completionToCommand</span></a></span></span><span> </span><span class="annot"><span class="annottext">Zsh
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier hs-var">stripZsh</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621679389931"><span class="annot"><span class="annottext">commandToComplete :: Zsh -&gt; String -&gt; String
</span><a href="XMonad.Prompt.html#commandToComplete"><span class="hs-identifier hs-var hs-var hs-var hs-var">commandToComplete</span></a></span></span><span> </span><span class="annot"><span class="annottext">Zsh
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679389929"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389929"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389929"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span id="local-6989586621679389928"><span class="annot"><span class="annottext">nextCompletion :: Zsh -&gt; String -&gt; [String] -&gt; String
</span><a href="XMonad.Prompt.html#nextCompletion"><span class="hs-identifier hs-var hs-var hs-var hs-var">nextCompletion</span></a></span></span><span> </span><span class="annot"><span class="annottext">Zsh
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679389926"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389926"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679389925"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679389925"><span class="hs-identifier hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
</span><a href="XMonad.Prompt.html#getNextCompletion"><span class="hs-identifier hs-var">getNextCompletion</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389926"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier hs-var">stripZsh</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679389925"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><a href="XMonad.Prompt.Zsh.html#zshPrompt"><span class="hs-identifier hs-type">zshPrompt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="XMonad.Prompt.html#XPConfig"><span class="hs-identifier hs-type">XPConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">X</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span id="zshPrompt"><span class="annot"><span class="annottext">zshPrompt :: XPConfig -&gt; String -&gt; X ()
</span><a href="XMonad.Prompt.Zsh.html#zshPrompt"><span class="hs-identifier hs-var hs-var">zshPrompt</span></a></span></span><span> </span><span id="local-6989586621679389922"><span class="annot"><span class="annottext">XPConfig
</span><a href="#local-6989586621679389922"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679389921"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389921"><span class="hs-identifier hs-var">capture</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Zsh -&gt; XPConfig -&gt; ComplFunction -&gt; (String -&gt; X ()) -&gt; X ()
forall p.
XPrompt p =&gt;
p -&gt; XPConfig -&gt; ComplFunction -&gt; (String -&gt; X ()) -&gt; X ()
</span><a href="XMonad.Prompt.html#mkXPrompt"><span class="hs-identifier hs-var">mkXPrompt</span></a></span><span> </span><span class="annot"><span class="annottext">Zsh
</span><a href="XMonad.Prompt.Zsh.html#Zsh"><span class="hs-identifier hs-var">Zsh</span></a></span><span> </span><span class="annot"><span class="annottext">XPConfig
</span><a href="#local-6989586621679389922"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ComplFunction
</span><a href="XMonad.Prompt.Zsh.html#getZshCompl"><span class="hs-identifier hs-var">getZshCompl</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389921"><span class="hs-identifier hs-var">capture</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679389919"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389919"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; X ()
forall (m :: * -&gt; *). MonadIO m =&gt; String -&gt; [String] -&gt; m ()
</span><a href="XMonad.Util.Run.html#safeSpawn"><span class="hs-identifier hs-var">safeSpawn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;zsh&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-c&quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389919"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><a href="XMonad.Prompt.Zsh.html#getZshCompl"><span class="hs-identifier hs-type">getZshCompl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span id="getZshCompl"><span class="annot"><span class="annottext">getZshCompl :: String -&gt; ComplFunction
</span><a href="XMonad.Prompt.Zsh.html#getZshCompl"><span class="hs-identifier hs-var hs-var">getZshCompl</span></a></span></span><span> </span><span id="local-6989586621679389917"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389917"><span class="hs-identifier hs-var">capture</span></a></span></span><span> </span><span id="local-6989586621679389916"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389916"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-56"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389916"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="#local-6989586621679389915"><span class="hs-identifier hs-var">processCompls</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; IO String -&gt; IO [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String -&gt; IO String
forall (m :: * -&gt; *).
MonadIO m =&gt;
String -&gt; [String] -&gt; String -&gt; m String
</span><a href="XMonad.Util.Run.html#runProcessWithInput"><span class="hs-identifier hs-var">runProcessWithInput</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389917"><span class="hs-identifier hs-var">capture</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389916"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679389915"><span class="annot"><span class="annottext">processCompls :: String -&gt; [String]
</span><a href="#local-6989586621679389915"><span class="hs-identifier hs-var hs-var">processCompls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679389912"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389912"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="XMonad.Prompt.html#skipLastWord"><span class="hs-identifier hs-var">skipLastWord</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389916"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; String
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\r'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389912"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String])
-&gt; (String -&gt; [String]) -&gt; String -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">lines</span></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Removes the argument description from the zsh completion</span><span>
</span><span id="line-61"></span><span class="annot"><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier hs-type">stripZsh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-62"></span><span id="stripZsh"><span class="annot"><span class="annottext">stripZsh :: String -&gt; String
</span><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier hs-var hs-var">stripZsh</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-63"></span><span class="annot"><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier hs-var">stripZsh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'-'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'-'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-64"></span><span class="annot"><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier hs-var">stripZsh</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679389907"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679389907"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679389906"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389906"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679389907"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="XMonad.Prompt.Zsh.html#stripZsh"><span class="hs-identifier hs-var">stripZsh</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679389906"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-65"></span></pre></body></html>