<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>XMonad.Doc.Developing</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">xmonad-contrib-0.18.1: Community-maintained extensions for xmonad</span><ul class="links" id="page-menu"><li><a href="src/XMonad.Doc.Developing.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(C) 2007 Andrea Rossato</td></tr><tr><th>License</th><td>BSD3</td></tr><tr><th>Maintainer</th><td>andrea.rossato@unibz.it</td></tr><tr><th>Stability</th><td>unstable</td></tr><tr><th>Portability</th><td>portable</td></tr><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">XMonad.Doc.Developing</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Writing new extensions</a></li><li><a href="#g:2">Libraries for writing window managers</a></li><li><a href="#g:3">xmonad internals</a><ul><li><a href="#g:4">The <code>main</code> entry point</a></li><li><a href="#g:5">The X monad and the internal state</a></li><li><a href="#g:6">Event handling and messages</a></li><li><a href="#g:7">The <code>LayoutClass</code></a></li></ul></li><li><a href="#g:8">Coding style</a></li><li><a href="#g:9">Licensing policy</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module gives a brief overview of the xmonad internals. It is
 intended for advanced users who are curious about the xmonad source
 code and want an brief overview. This document may also be helpful
 for the beginner/intermediate Haskell programmer who is motivated
 to write an xmonad extension as a way to deepen her understanding
 of this powerful functional language; however, there is not space
 here to go into much detail.  For a more comprehensive document
 covering some of the same material in more depth, see the guided
 tour of the xmonad source on the xmonad wiki:
 <a href="http://haskell.org/haskellwiki/Xmonad/Guided_tour_of_the_xmonad_source">http://haskell.org/haskellwiki/Xmonad/Guided_tour_of_the_xmonad_source</a>.</p><p>If you write an extension module and think it may be useful for
 others, consider releasing it.  Coding guidelines and licensing
 policies are covered at the end of this document, and must be
 followed if you want your code to be included in the official
 repositories.  For a basic tutorial on the nuts and bolts of
 developing a new extension for xmonad, see the tutorial on the
 wiki:
 <a href="http://haskell.org/haskellwiki/Xmonad/xmonad_development_tutorial">http://haskell.org/haskellwiki/Xmonad/xmonad_development_tutorial</a>.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Writing new extensions</h1></a><div class="doc"><p>Here are some libraries that may be useful when writing your own module:</p><ul><li>XMonad.Prelude: Re-export commonly used functions from prelude, as
    well as some xmonad-specific helpers.</li></ul></div><a href="#g:2" id="g:2"><h1>Libraries for writing window managers</h1></a><div class="doc"><p>Starting with version 0.5, xmonad and xmonad-contrib are packaged and
distributed as libraries, instead of components which must be compiled
by the user into a binary (as they were prior to version 0.5). This
way of distributing xmonad has many advantages, since it allows
packaging by GNU/Linux distributions while still allowing the user to
customize the window manager to fit her needs.</p><p>Basically, xmonad and the xmonad-contrib libraries let users write
their own window manager in just a few lines of code. While
<code>xmonad.hs</code> at first seems to be simply a configuration
file, it is actually a complete Haskell program which uses the xmonad
and xmonad-contrib libraries to create a custom window manager.</p><p>This makes it possible not only to edit the default xmonad
configuration, as we have seen in the <a href="XMonad-Doc-Extending.html">XMonad.Doc.Extending</a> document,
but to use the Haskell programming language to extend the window
manager you are writing in any way you see fit.</p></div><a href="#g:3" id="g:3"><h1>xmonad internals</h1></a><div class="doc empty">&nbsp;</div><a href="#g:4" id="g:4"><h2>The <code>main</code> entry point</h2></a><div class="doc"><p><a id="The_main_entry_point"></a></p><p>xmonad installs a binary, <code>xmonad</code>, which must be executed by the
Xsession starting script. This binary, whose code can be read in
<code>Main.hs</code> of the xmonad source tree, will use <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:recompile" title="XMonad.Core">recompile</a></code>
to run <code>ghc</code> in order to build a binary from <code>xmonad.hs</code>.
If this compilation process fails, for any reason, a default <code>main</code>
entry point will be used, which calls the <code><a href="../xmonad-0.18.0.9/XMonad-Main.html#v:xmonad" title="XMonad.Main">xmonad</a></code>
function with a default configuration.</p><p>Thus, the real <code>main</code> entry point, the one that even the users' custom
window manager application in <code>xmonad.hs</code> must call, is
the <code><a href="../xmonad-0.18.0.9/XMonad-Main.html#v:xmonad" title="XMonad.Main">xmonad</a></code> function. This function takes a configuration
as its only argument, whose type (<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XConfig" title="XMonad.Core">XConfig</a></code>)
is defined in <a href="../xmonad-0.18.0.9/XMonad-Core.html">XMonad.Core</a>.</p><p><code><a href="../xmonad-0.18.0.9/XMonad-Main.html#v:xmonad" title="XMonad.Main">xmonad</a></code> takes care of opening the connection with the X
server, initializing the state (or deserializing it when restarted)
and the configuration, and calling the event handler
(<code><a href="../xmonad-0.18.0.9/XMonad-Main.html#v:handle" title="XMonad.Main">handle</a></code>) that goes into an infinite loop (using
<code><a href="../base-4.16.4.0/Prelude.html#v:forever" title="Prelude">forever</a></code>) waiting for events and acting accordingly.</p></div><a href="#g:5" id="g:5"><h2>The X monad and the internal state</h2></a><div class="doc"><p>The event loop which calls <code><a href="../xmonad-0.18.0.9/XMonad-Main.html#v:handle" title="XMonad.Main">handle</a></code> to react to events is
run within the <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:X" title="XMonad.Core">X</a></code> monad, which is a
<code><a href="../mtl-2.2.2/Control-Monad-State.html#v:StateT" title="Control.Monad.State">StateT</a></code> transformer over <code><a href="XMonad-Config-Prime.html#t:IO" title="XMonad.Config.Prime">IO</a></code>, encapsulated
within a <code><a href="../mtl-2.2.2/Control-Monad-Reader.html#v:ReaderT" title="Control.Monad.Reader">ReaderT</a></code> transformer. The
<code><a href="../mtl-2.2.2/Control-Monad-State.html#v:StateT" title="Control.Monad.State">StateT</a></code> transformer encapsulates the
(read/writable) state of the window manager (of type
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XState" title="XMonad.Core">XState</a></code>), whereas the <code><a href="../mtl-2.2.2/Control-Monad-Reader.html#v:ReaderT" title="Control.Monad.Reader">ReaderT</a></code>
transformer encapsulates the (read-only) configuration (of type
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XConf" title="XMonad.Core">XConf</a></code>).</p><p>Thanks to GHC's newtype deriving feature, the instance of the
<code><a href="../mtl-2.2.2/Control-Monad-State.html#v:MonadState" title="Control.Monad.State">MonadState</a></code> class parametrized over
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XState" title="XMonad.Core">XState</a></code> and the instance of the
<code><a href="../mtl-2.2.2/Control-Monad-Reader.html#v:MonadReader" title="Control.Monad.Reader">MonadReader</a></code> class parametrized over
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XConf" title="XMonad.Core">XConf</a></code> are automatically derived for the <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:X" title="XMonad.Core">X</a></code>
monad. This way we can use <code><a href="../mtl-2.2.2/Control-Monad-State.html#v:get" title="Control.Monad.State">get</a></code>,
<code><a href="../mtl-2.2.2/Control-Monad-State.html#v:gets" title="Control.Monad.State">gets</a></code> and <code><a href="../mtl-2.2.2/Control-Monad-State.html#v:modify" title="Control.Monad.State">modify</a></code> for the
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XState" title="XMonad.Core">XState</a></code>, and <code><a href="../mtl-2.2.2/Control-Monad-Reader.html#v:ask" title="Control.Monad.Reader">ask</a></code> and
<code><a href="../mtl-2.2.2/Control-Monad-Reader.html#v:asks" title="Control.Monad.Reader">asks</a></code> for reading the <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XConf" title="XMonad.Core">XConf</a></code>.</p><p><code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XState" title="XMonad.Core">XState</a></code> is where all the sensitive information about
window management is stored. The most important field of the
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XState" title="XMonad.Core">XState</a></code> is the <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:windowset" title="XMonad.Core">windowset</a></code>, whose type
(<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:WindowSet" title="XMonad.Core">WindowSet</a></code>) is a synonym for a
<code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:StackSet" title="XMonad.StackSet">StackSet</a></code> parametrized over a
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:WorkspaceID" title="XMonad.Core">WorkspaceID</a></code> (a <code><a href="XMonad-Config-Prime.html#t:String" title="XMonad.Config.Prime">String</a></code>), a layout type wrapped inside
the <code><a href="../xmonad-0.18.0.9/XMonad-Layout.html#v:Layout" title="XMonad.Layout">Layout</a></code> existential data type, the
<code><a href="../X11-1.10.3.10/Graphics-X11-Types.html#v:Window" title="Graphics.X11.Types">Window</a></code> type, the <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:ScreenID" title="XMonad.Core">ScreenID</a></code> and the
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:ScreenDetail" title="XMonad.Core">ScreenDetail</a></code>s.</p><p>What a <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:StackSet" title="XMonad.StackSet">StackSet</a></code> is and how it can be manipulated
with pure functions is described in the Haddock documentation of the
<a href="../xmonad-0.18.0.9/XMonad-StackSet.html">XMonad.StackSet</a> module.</p><p>The <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:StackSet" title="XMonad.StackSet">StackSet</a></code> (<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:WindowSet" title="XMonad.Core">WindowSet</a></code>) has four
fields:</p><ul><li><code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:current" title="XMonad.StackSet">current</a></code>, for the current, focused workspace. This
  is a <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:Screen" title="XMonad.StackSet">Screen</a></code>, which is composed of a
  <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:Workspace" title="XMonad.StackSet">Workspace</a></code> together with the screen information (for
  Xinerama support).</li><li><code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:visible" title="XMonad.StackSet">visible</a></code>, a list of <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:Screen" title="XMonad.StackSet">Screen</a></code>s for
  the other visible (with Xinerama) workspaces.  For non-Xinerama
  setups, this list is always empty.</li><li><code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:hidden" title="XMonad.StackSet">hidden</a></code>, the list of non-visible
  <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:Workspace" title="XMonad.StackSet">Workspace</a></code>s.</li><li><code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:floating" title="XMonad.StackSet">floating</a></code>, a map from floating
  <code><a href="../X11-1.10.3.10/Graphics-X11-Types.html#v:Window" title="Graphics.X11.Types">Window</a></code>s to <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:RationalRect" title="XMonad.StackSet">RationalRect</a></code>s
  specifying their geometry.</li></ul><p>The <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:Workspace" title="XMonad.StackSet">Workspace</a></code> type is made of a
<code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:tag" title="XMonad.StackSet">tag</a></code>, a <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:layout" title="XMonad.StackSet">layout</a></code> and
a (possibly empty) <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:stack" title="XMonad.StackSet">stack</a></code> of windows.</p><p><a href="../xmonad-0.18.0.9/XMonad-StackSet.html">XMonad.StackSet</a> (which should usually be imported qualified, to
avoid name clashes with Prelude functions such as <code><a href="../base-4.16.4.0/Prelude.html#v:delete" title="Prelude">delete</a></code> and
<code><a href="XMonad-Prelude.html#v:filter" title="XMonad.Prelude">filter</a></code>) provides many pure functions to manipulate the
<code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:StackSet" title="XMonad.StackSet">StackSet</a></code>. These functions are most commonly used as
an argument to <code><a href="../xmonad-0.18.0.9/XMonad-Operations.html#v:windows" title="XMonad.Operations">windows</a></code>, which takes a pure
function to manipulate the <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:WindowSet" title="XMonad.Core">WindowSet</a></code> and does all the
needed operations to refresh the screen and save the modified
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:XState" title="XMonad.Core">XState</a></code>.</p><p>During each <code><a href="../xmonad-0.18.0.9/XMonad-Operations.html#v:windows" title="XMonad.Operations">windows</a></code> call, the
<code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:layout" title="XMonad.StackSet">layout</a></code> field of the <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:current" title="XMonad.StackSet">current</a></code> and
<code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:visible" title="XMonad.StackSet">visible</a></code> <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:Workspace" title="XMonad.StackSet">Workspace</a></code>s are used to
physically arrange the <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:stack" title="XMonad.StackSet">stack</a></code> of windows on each
workspace.</p><p>The possibility of manipulating the <code><a href="../xmonad-0.18.0.9/XMonad-StackSet.html#v:StackSet" title="XMonad.StackSet">StackSet</a></code>
(<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:WindowSet" title="XMonad.Core">WindowSet</a></code>) with pure functions makes it possible to
test all the properties of those functions with QuickCheck, providing
greater reliability of the core code. Every change to the
<a href="../xmonad-0.18.0.9/XMonad-StackSet.html">XMonad.StackSet</a> module must be accompanied by appropriate QuickCheck
properties before being applied.</p></div><a href="#g:6" id="g:6"><h2>Event handling and messages</h2></a><div class="doc"><p>Event handling is the core activity of xmonad.  Events generated by
the X server are most important, but there may also be events
generated by layouts or the user.</p><p><a href="../xmonad-0.18.0.9/XMonad-Core.html">XMonad.Core</a> defines a class that generalizes the concept of events,
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:Message" title="XMonad.Core">Message</a></code>, constrained to types with a
<code><a href="../base-4.16.4.0/Data-Typeable.html#v:Typeable" title="Data.Typeable">Typeable</a></code> instance definition (which can be
automatically derived by GHC). <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:Message" title="XMonad.Core">Message</a></code>s are wrapped
within an existential type <code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:SomeMessage" title="XMonad.Core">SomeMessage</a></code>. The
<code><a href="../base-4.16.4.0/Data-Typeable.html#v:Typeable" title="Data.Typeable">Typeable</a></code> constraint allows for the definition of a
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:fromMessage" title="XMonad.Core">fromMessage</a></code> function that can unwrap the message with
<code><a href="../base-4.16.4.0/Data-Typeable.html#v:cast" title="Data.Typeable">cast</a></code>.  X Events are instances of this class, along
with any messages used by xmonad itself or by extension modules.</p><p>Using the <code><a href="../base-4.16.4.0/Data-Typeable.html#v:Typeable" title="Data.Typeable">Typeable</a></code> class for any kind of
<code><a href="../xmonad-0.18.0.9/XMonad-Core.html#v:Message" title="XMonad.Core">Message</a></code>s and events allows us to define polymorphic functions
for processing messages or unhandled events.</p><p>This is precisely what happens with X events: xmonad passes them to
<code><a href="../xmonad-0.18.0.9/XMonad-Main.html#v:handle" title="XMonad.Main">handle</a></code>. If the main event handling function doesn't have
anything to do with the event, the event is sent to all visible
layouts by <code><a href="../xmonad-0.18.0.9/XMonad-Operations.html#v:broadcastMessage" title="XMonad.Operations">broadcastMessage</a></code>.</p><p>This messaging system allows the user to create new message types,
simply declare an instance of the <code><a href="../base-4.16.4.0/Data-Typeable.html#v:Typeable" title="Data.Typeable">Typeable</a></code> and use
<code><a href="../xmonad-0.18.0.9/XMonad-Operations.html#v:sendMessage" title="XMonad.Operations">sendMessage</a></code> to send commands to layouts.</p><p>And, finally, layouts may handle X events and other messages within the
same function... miracles of polymorphism.</p></div><a href="#g:7" id="g:7"><h2>The <code>LayoutClass</code></h2></a><div class="doc"><p><a id="The_LayoutClass"></a>
to do</p></div><a href="#g:8" id="g:8"><h1>Coding style</h1></a><div class="doc"><p>For coding style guidelines while contributing, please see the
<a href="https://github.com/xmonad/xmonad/blob/master/CONTRIBUTING.md#style-guidelines">style guidelines</a>
of xmonad's CONTRIBUTING.md.</p><p>For examples of Haddock documentation syntax, have a look at
<a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html">its documentation</a>
or other extensions.  Important points are:</p><ul><li>Every exported function (or even better, every function) should have
  a Haddock comment explaining what it does, and providing examples.</li><li>Literal chunks of code can be written in comments using
  &quot;birdtrack&quot; notation (a greater-than symbol at the beginning of
  each line).  Be sure to leave a blank line before and after each
  birdtrack-quoted section.</li><li>Link to functions by surrounding the names in single quotes, modules
  in double quotes.</li><li>Literal quote marks and slashes should be escaped with a backslash.</li></ul><p>To generate and view the Haddock documentation for your extension, run</p><pre>stack haddock --no-haddock-deps</pre><p>If the builds succeeds, at the end stack should tell you where the
generated <code>index.html</code> is located.</p><p>Alternatively, you can also run</p><pre>cabal haddock</pre><p>to similar effect.</p><p>For more information, see the Haddock documentation:
<a href="http://www.haskell.org/haddock/doc/html/index.html">http://www.haskell.org/haddock/doc/html/index.html</a>.</p><p>For more information on the nuts and bolts of how to develop your own
extension, see the tutorial on the wiki:
<a href="http://haskell.org/haskellwiki/Xmonad/xmonad_development_tutorial">http://haskell.org/haskellwiki/Xmonad/xmonad_development_tutorial</a>.</p></div><a href="#g:9" id="g:9"><h1>Licensing policy</h1></a><div class="doc"><p>New modules should identify the author, and be submitted under the
same license as xmonad (BSD3).</p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>